---
title: "Об анализе зависимостей"
output: html_notebook
---

Независимость случайных величин: $$\displaystyle{{p_{\xi,\eta}(x, y_0)}\over{p_{\eta}(y_0)}} = p_\xi(x),$$
при таких $y_0$, что $p_{\eta}(y_0) ≠ 0$.

Для рассмотрения видов зависимости понадобится _функция условного математического ожидания_:
$$
	\phi(x) = \mathbf{E}\{\eta | \xi = x\},
	\label{def1:ref}
$$
где $\mathbf{E}\{\eta | \xi = x\} = \min_{\hat\eta \in \{\varphi(\xi)\}}\mathbf{E}(\eta - \hat\eta)^2$

В зависимости от вида функции условного математического ожидания (линейная, степенная и т.д.) и называется зависимость.

Линейная зависимость измеряется коэффициентом корреляции Пирсона: $$\rho = \displaystyle{{cov(\xi,\eta)}\over{\sqrt{\mathbf{D}\xi}\sqrt{\mathbf{D}\eta}}},$$
где $cov(\xi,\eta) = \mathbf{E}\{(\xi - \mathbf{E}\xi)(\eta - \mathbf{E}\eta)\}$

Помимо коэффициента корреляции Пирсона, сущесвтует коэффициент корреляции Спирмена:
$$\rho_{S} = \rho(\mathrm{cdf}_{\xi}(\xi), \mathrm{cdf}_\eta(\eta)),$$

где $\mathrm{cdf}_{\xi}(\xi)$ --- это функция распределения $\xi$ (сокращение от _cumulative distribution function_)
```{r}
data <- read.csv("TeachingRatings.csv");
head(data)
```
В этом наборе данных есть 13 переменных:

1. X --- идентификатор курса;
1. minority --- принадлежит ли преподаватель к меньшинству;
2. age --- возраст преподавателя;
3. gender --- пол преподавателя;
4. credits --- является ли предмет факультативным;
5. beauty --- оценка физического облика преподавателя группой из шести студентов, усредненная по шести участникам оценки, нормированная;
6. eval --- оценка преподавания курса от 1 (очень плохо) до 5 (отлично);
7. division --- является ли этот курс курсом высшего или низшего отделения (Курсы низшего отделения --- это в основном большие курсы первокурсников и второкурсников);
8. native --- является ли преподаватель носителем английского языка;
9. tenure --- имеет ли преподаватель учёную степень;
10. students --- количетсво студентов, участвовавших в оценке;
11. allstudents --- общее количетсво студентов, обучавшихся на этом курсе;
12. prof --- идентификатор преподавателя;

```{r}
filteredData_s = data[data$prof!=73, ]
filteredData_s['log'] = log(filteredData_s$allstudents)
filteredData_s['log2'] = log(filteredData_s$students)
subset_data = subset(filteredData_s, division=="upper" & minority=="no" & gender=="male" & credits=="more" & native=="yes" & tenure=="yes")
pairs(~age+beauty+log2+eval+log,data=subset_data)

```
Похоже, что _age_ и _beauty_ имеют линейную зависимость. Проверим. Посчитаем коэффициент корреляции, а заодно и оценим его статистическую значимость:

```{r}
cor.test(subset_data$age, subset_data$beauty)
```
Гипотиза о том, что коэффициент корреляции Пирсона равен нулю отвергается. Оценка этого коэффициента __-0.4948131__. Проверим, для сравнения, коэффициент корреляции между количеством студентов, проголосовавших в опросе и посетивших курс:
```{r}
cor.test(subset_data$log2, subset_data$log)
```
Гипотиза о том, что коэффициент корреляции Пирсона равен нулю отвергается. Оценка этого коэффициента __0.9455546__. Это вполне согласуется с тем, что видно на графике. В нашем случае пропусков в данных нет, однако если бы они были, то нужно было бы применить одну из двух техник борьбы с ними: 

- Удалить всю строку с пропуском (casewise) и анализировать индивидуумы с заполненными нужными полями
- Рассматривать заполненные поля при рассчёте корреляции (индивидуумы могут быть разными)
В первом случае есть риск получить выборку слишком маленького размера, а во втором корреляция получается рассчитана на разных данных, возможно влияние какого-то третьего признака.